const visitorData = `土,170401,52,1
日,170402,89,1
月,170403,21,1
火,170404,17,1
水,170405,0,1
木,170406,5,1
金,170407,2,1
土,170408,15,1
日,170409,21,1
月,170410,1,1
火,170411,0,1
水,170412,0,1
木,170413,0,1
金,170414,3,1
土,170415,35,1
日,170416,45,1
月,170417,0,1
火,170418,0,1
水,170419,0,1
木,170420,5,1
金,170421,5,1
土,170422,33,1
日,170423,57,1
月,170424,10,1
火,170425,6,1
水,170426,0,1
木,170427,3,1
金,170428,5,1
土,170429,123,1
日,170430,147,1
月,170501,32,1
火,170502,54,1
水,170503,337,1
木,170504,346,1
金,170505,316,1
土,170506,136,1
日,170507,162,1
月,170508,11,1
火,170509,2,1
水,170510,0,1
木,170511,6,1
金,170512,4,1
土,170513,19,1
日,170514,59,1
月,170515,4,1
火,170516,9,1
水,170517,0,1
木,170518,6,1
金,170519,7,1
土,170520,23,1
日,170521,59,1
月,170522,10,1
火,170523,6,1
水,170524,0,1
木,170525,5,1
金,170526,8,1
土,170527,48,1
日,170528,59,1
月,170529,32,1
火,170530,2,1
水,170531,0,1
木,170601,2,1
金,170602,5,1
土,170603,30,1
日,170604,72,1
月,170605,23,1
火,170606,11,1
水,170607,0,1
木,170608,1,1
金,170609,11,1
土,170610,30,1
日,170611,64,1
月,170612,8,1
火,170613,10,1
水,170614,0,1
木,170615,3,1
金,170616,11,1
土,170617,32,1
日,170618,49,1
月,170619,14,1
火,170620,7,1
水,170621,0,1
木,170622,1,1
金,170623,2,1
土,170624,39,1
日,170625,9,1
月,170626,6,1
火,170627,7,1
水,170628,0,1
木,170629,0,1
金,170630,0,1
土,170701,13,1
日,170702,45,1
月,170703,3,1
火,170704,5,1
水,170705,0,1
木,170706,4,1
金,170707,3,1
土,170708,11,1
日,170709,20,1
月,170710,9,1
火,170711,10,1
水,170712,0,1
木,170713,15,1
金,170714,5,1
土,170715,73,1
日,170716,163,1
月,170717,87,1
火,170718,10,1
水,170719,0,1
木,170720,15,1
金,170721,26,1
土,170722,51,1
日,170723,81,1
月,170724,33,1
火,170725,18,1
水,170726,39,1
木,170727,32,1
金,170728,43,1
土,170729,100,1
日,170730,97,1
月,170731,37,1
火,170801,48,1
水,170802,43,1
木,170803,25,1
金,170804,59,1
土,170805,86,1
日,170806,157,1
月,170807,3,1
火,170808,67,1
水,170809,95,1
木,170810,78,1
金,170811,154,1
土,170812,235,1
日,170813,293,1
月,170814,268,1
火,170815,129,1
水,170816,163,1
木,170817,137,1
金,170818,124,1
土,170819,133,1
日,170820,162,1
月,170821,98,1
火,170822,56,1
水,170823,76,1
木,170824,48,1
金,170825,37,1
土,170826,94,1
日,170827,135,1
月,170828,71,1
火,170829,51,1
水,170830,28,1
木,170831,28,1
金,170901,7,1
土,170902,75,1
日,170903,91,1
月,170904,15,1
火,170905,10,1
水,170906,0,1
木,170907,0,1
金,170908,17,1
土,170909,69,1
日,170910,91,1
月,170911,26,1
火,170912,4,1
水,170913,0,1
木,170914,16,1
金,170915,5,1
土,170916,8,1
日,170917,15,1
月,170918,85,1
火,170919,16,1
水,170920,0,1
木,170921,9,1
金,170922,8,1
土,170923,85,1
日,170924,95,1
月,170925,17,1
火,170926,8,1
水,170927,0,1
木,170928,4,1
金,170929,12,1
土,170930,32,1
日,171001,81,1
月,171002,6,1
火,171003,0,1
水,171004,0,1
木,171005,4,1
金,171006,0,1
土,171007,64,1
日,171008,200,1
月,171009,115,1
火,171010,8,1
水,171011,0,1
木,171012,9,1
金,171013,5,1
土,171014,41,1
日,171015,1,1
月,171016,2,1
火,171017,16,1
水,171018,0,1
木,171019,3,1
金,171020,5,1
土,171021,9,1
日,171022,48,1
月,171023,4,1
火,171024,11,1
水,171025,0,1
木,171026,9,1
金,171027,19,1
土,171028,5,1
日,171029,9,1
月,171030,9,1
火,171031,5,1
水,171101,0,1
木,171102,9,1
金,171103,146,1
土,171104,16,1
日,171105,125,1
月,171106,14,1
火,171107,0,1
水,171108,11,1
木,171109,3,1
金,171110,7,1
土,171111,18,1
日,171112,82,1
月,171113,10,1
火,171114,11,1
水,171115,0,1
木,171116,1,1
金,171117,3,1
土,171118,9,1
日,171119,5,1
月,171120,8,1
火,171121,3,1
水,171122,0,1
木,171123,19,1
金,171124,0,1
土,171125,49,1
日,171126,23,1
月,171127,4,1
火,171128,7,1
水,171129,0,1
木,171130,2,1
金,171201,1,1
土,171202,23,1
日,171203,35,1
月,171204,0,1
火,171205,0,1
水,171206,0,1
木,171207,0,1
金,171208,2,1
土,171209,3,1
日,171210,4,1
月,171211,0,1
火,171212,0,1
水,171213,0,1
木,171214,0,1
金,171215,4,1
土,171216,4,1
日,171217,3,1
月,171218,1,1
火,171219,0,1
水,171220,0,1
木,171221,0,1
金,171222,0,1
土,171223,9,1
日,171224,6,1
月,171225,0,1
火,171226,0,1
水,171227,0,1
木,171228,5,1
金,171229,10,1
土,171230,16,1
日,171231,0,1
月,180101,0,1
火,180102,0,1
水,180103,5,1
木,180104,11,1
金,180105,6,1
土,180106,13,1
日,180107,13,1
月,180108,0,1
火,180109,0,1
水,180110,0,1
木,180111,0,1
金,180112,0,1
土,180113,0,1
日,180114,2,1
月,180115,0,1
火,180116,0,1
水,180117,0,1
木,180118,0,1
金,180119,2,1
土,180120,9,1
日,180121,5,1
月,180122,2,1
火,180123,0,1
水,180124,0,1
木,180125,0,1
金,180126,0,1
土,180127,0,1
日,180128,0,1
月,180129,0,1
火,180130,3,1
水,180131,0,1
木,180201,0,1
金,180202,0,1
土,180203,3,1
日,180204,0,1
月,180205,0,1
火,180206,0,1
水,180207,0,1
木,180208,0,1
金,180209,4,1
土,180210,3,1
日,180211,3,1
月,180212,0,1
火,180213,0,1
水,180214,0,1
木,180215,0,1
金,180216,1,1
土,180217,8,1
日,180218,1,1
月,180219,0,1
火,180220,8,1
水,180221,0,1
木,180222,0,1
金,180223,0,1
土,180224,7,1
日,180225,14,1
月,180226,2,1
火,180227,0,1
水,180228,0,1
木,180301,0,1
金,180302,1,1
土,180303,6,1
日,180304,34,1
月,180305,0,1
火,180306,4,1
水,180307,0,1
木,180308,0,1
金,180309,3,1
土,180310,32,1
日,180311,37,1
月,180312,10,1
火,180313,4,1
水,180314,0,1
木,180315,10,1
金,180316,0,1
土,180317,44,1
日,180318,32,1
月,180319,3,1
火,180320,1,1
水,180321,4,1
木,180322,0,1
金,180323,13,1
土,180324,54,1
日,180325,58,1
月,180326,54,1
火,180327,42,1
水,180328,0,1
木,180329,20,1
金,180330,31,1
土,180331,68,1
日,180401,81,1
月,180402,44,1
火,180403,24,1
水,180404,0,1
木,180405,10,1
金,180406,3,1
土,180407,7,1
日,180408,34,1
月,180409,3,1
火,180410,6,1
水,180411,0,1
木,180412,8,1
金,180413,8,1
土,180414,11,1
日,180415,28,1
月,180416,12,1
火,180417,3,1
水,180418,0,1
木,180419,1,1
金,180420,5,1
土,180421,50,1
日,180422,60,1
月,180423,4,1
火,180424,0,1
水,180425,0,1
木,180426,10,1
金,180427,2,1
土,180428,95,1
日,180429,225,1
月,180430,221,1
火,180501,75,1
水,180502,5,1
木,180503,247,1
金,180504,306,1
土,180505,292,1
日,180506,115,1
月,180507,0,1
火,180508,9,1
水,180509,0,1
木,180510,1,1
金,180511,7,1
土,180512,24,1
日,180513,0,1
月,180514,3,1
火,180515,7,1
水,180516,0,1
木,180517,9,1
金,180518,0,1
土,180519,5,1
日,180520,58,1
月,180521,14,1
火,180522,12,1
水,180523,0,1
木,180524,13,1
金,180525,7,1
土,180526,43,1
日,180527,71,1
月,180528,16,1
火,180529,5,1
水,180530,0,1
木,180531,0,1
金,180601,14,1
土,180602,47,1
日,180603,58,1
月,180604,11,1
火,180605,2,1
水,180606,0,1
木,180607,0,1
金,180608,0,1
土,180609,38,1
日,180610,29,1
月,180611,2,1
火,180612,2,1
水,180613,0,1
木,180614,15,1
金,180615,6,1
土,180616,32,1
日,180617,54,1
月,180618,2,1
火,180619,3,1
水,180620,0,1
木,180621,0,1
金,180622,7,1
土,180623,19,1
日,180624,51,1
月,180625,2,1
火,180626,8,1
水,180627,0,1
木,180628,8,1
金,180629,3,1
土,180630,9,1
日,180701,53,1
月,180702,3,1
火,180703,1,1
水,180704,0,1
木,180705,0,1
金,180706,0,1
土,180707,0,1
日,180708,2,1
月,180709,4,1
火,180710,2,1
水,180711,0,1
木,180712,2,1
金,180713,3,1
土,180714,29,1
日,180715,98,1
月,180716,73,1
火,180717,6,1
水,180718,0,1
木,180719,5,1
金,180720,3,1
土,180721,14,1
日,180722,62,1
月,180723,23,1
火,180724,33,1
水,180725,21,1
木,180726,17,1
金,180727,44,1
土,180728,84,1
日,180729,23,1
月,180730,37,1
火,180731,39,1
水,180801,61,1
木,180802,55,1
金,180803,33,1
土,180804,83,1
日,180805,121,1
月,180806,36,1
火,180807,66,1
水,180808,46,1
木,180809,49,1
金,180810,37,1
土,180811,171,1
日,180812,177,1
月,180813,194,1
火,180814,204,1
水,180815,186,1
木,180816,56,1
金,180817,176,1
土,180818,168,1
日,180819,161,1
月,180820,92,1
火,180821,79,1
水,180822,65,1
木,180823,39,1
金,180824,42,1
土,180825,82,1
日,180826,125,1
月,180827,79,1
火,180828,57,1
水,180829,38,1
木,180830,44,1
金,180831,16,1
土,180901,24,1
日,180902,100,1
月,180903,7,1
火,180904,4,1
水,180905,0,1
木,180906,15,1
金,180907,10,1
土,180908,3,1
日,180909,6,1
月,180910,0,1
火,180911,10,1
水,180912,0,1
木,180913,15,1
金,180914,6,1
土,180915,47,1
日,180916,183,1
月,180917,52,1
火,180918,17,1
水,180919,0,1
木,180920,0,1
金,180921,3,1
土,180922,92,1
日,180923,181,1
月,180924,86,1
火,180925,6,1
水,180926,0,1
木,180927,4,1
金,180928,11,1
土,180929,7,1
日,180930,0,1
月,181001,7,1
火,181002,7,1
水,181003,0,1
木,181004,0,1
金,181005,2,1
土,181006,8,1
日,181007,106,1
月,181008,127,1
火,181009,19,1
水,181010,0,1
木,181011,2,1
金,181012,2,1
土,181013,66,1
日,181014,68,1
月,181015,16,1
火,181016,6,1
水,181017,0,1
木,181018,14,1
金,181019,9,1
土,181020,46,1
日,181021,93,1
月,181022,17,1
火,181023,2,1
水,181024,0,1
木,181025,6,1
金,181026,7,1
土,181027,36,1
日,181028,72,1
月,181029,22,1
火,181030,4,1
水,181031,0,1
木,181101,5,1
金,181102,13,1
土,181103,78,1
日,181104,99,1
月,181105,10,1
火,181106,9,1
水,181107,0,1
木,181108,6,1
金,181109,0,1
土,181110,33,1
日,181111,84,1
月,181112,5,1
火,181113,5,1
水,181114,0,1
木,181115,12,1
金,181116,2,1
土,181117,5,1
日,181118,63,1
月,181119,8,1
火,181120,4,1
水,181121,0,1
木,181122,0,1
金,181123,44,1
土,181124,67,1
日,181125,54,1
月,181126,15,1
火,181127,3,1
水,181128,0,1
木,181129,7,1
金,181130,7,1
土,181201,11,1
日,181202,29,1
月,181203,0,1
火,181204,0,1
水,181205,0,1
木,181206,0,1
金,181207,0,1
土,181208,14,1
日,181209,17,1
月,181210,3,1
火,181211,0,1
水,181212,0,1
木,181213,0,1
金,181214,0,1
土,181215,1,1
日,181216,3,1
月,181217,0,1
火,181218,0,1
水,181219,0,1
木,181220,0,1
金,181221,2,1
土,181222,3,1
日,181223,9,1
月,181224,2,1
火,181225,6,1
水,181226,0,1
木,181227,0,1
金,181228,0,1
土,181229,9,1
日,181230,0,1
月,181231,0,1
火,190101,0,1
水,190102,0,1
木,190103,0,1
金,190104,12,1
土,190105,13,1
日,190106,4,1
月,190107,2,1
火,190108,0,1
水,190109,0,1
木,190110,0,1
金,190111,2,1
土,190112,0,1
日,190113,10,1
月,190114,15,1
火,190115,0,1
水,190116,0,1
木,190117,0,1
金,190118,1,1
土,190119,2,1
日,190120,5,1
月,190121,0,1
火,190122,0,1
水,190123,0,1
木,190124,0,1
金,190125,3,1
土,190126,0,1
日,190127,1,1
月,190128,0,1
火,190129,0,1
水,190130,0,1
木,190131,0,1
金,190201,0,1
土,190202,9,1
日,190203,0,1
月,190204,0,1
火,190205,0,1
水,190206,0,1
木,190207,2,1
金,190208,3,1
土,190209,5,1
日,190210,11,1
月,190211,2,1
火,190212,0,1
水,190213,0,1
木,190214,1,1
金,190215,0,1
土,190216,7,1
日,190217,2,1
月,190218,9,1
火,190219,0,1
水,190220,0,1
木,190221,0,1
金,190222,0,1
土,190223,6,1
日,190224,28,1
月,190225,13,1
火,190226,0,1
水,190227,0,1
木,190228,1,1
金,190301,0,1
土,190302,8,1
日,190303,12,1
月,190304,0,1
火,190305,5,1
水,190306,0,1
木,190307,0,1
金,190308,2,1
土,190309,27,1
日,190310,3,1
月,190311,0,1
火,190312,0,1
水,190313,0,1
木,190314,3,1
金,190315,0,1
土,190316,4,1
日,190317,12,1
月,190318,4,1
火,190319,6,1
水,190320,0,1
木,190321,17,1
金,190322,5,1
土,190323,19,1
日,190324,55,1
月,190325,19,1
火,190326,19,1
水,190327,0,1
木,190328,12,1
金,190329,47,1
土,190330,24,1
日,190331,29,1
月,190401,4,1
火,190402,2,1
水,190403,0,1
木,190404,20,1
金,190405,13,1
土,190406,44,1
日,190407,37,1
月,190408,5,1
火,190409,4,1
水,190410,0,1
木,190411,2,1
金,190412,2,1
土,190413,46,1
日,190414,9,1
月,190415,5,1
火,190416,6,1
水,190417,0,1
木,190418,1,1
金,190419,5,1
土,190420,28,1
日,190421,50,1
月,190422,5,1
火,190423,2,1
水,190424,0,1
木,190425,9,1
金,190426,0,1
土,190427,54,1
日,190428,238,1
月,190429,131,1
火,190430,194,1
水,190501,265,1
木,190502,260,1
金,190503,312,1
土,190504,308,1
日,190505,273,1
月,190506,70,1
火,190507,5,1
水,190508,0,1
木,190509,1,1
金,190510,4,1
土,190511,20,1
日,190512,52,1
月,190513,6,1
火,190514,0,1
水,190515,0,1
木,190516,2,1
金,190517,3,1
土,190518,14,1
日,190519,41,1
月,190520,2,1
火,190521,4,1
水,190522,0,1
木,190523,8,1
金,190524,6,1
土,190525,36,1
日,190526,49,1
月,190527,18,1
火,190528,0,1
水,190529,0,1
木,190530,1,1
金,190531,0,1
土,190601,27,1
日,190602,41,1
月,190603,14,1
火,190604,4,1
水,190605,0,1
木,190606,5,1
金,190607,0,1
土,190608,6,1
日,190609,44,1
月,190610,7,1
火,190611,1,1
水,190612,0,1
木,190613,18,1
金,190614,13,1
土,190615,3,1
日,190616,15,1
月,190617,15,1
火,190618,6,1
水,190619,0,1
木,190620,1,1
金,190621,5,1
土,190622,8,1
日,190623,121,1
月,190624,9,1
火,190625,8,1
水,190626,0,1
木,190627,2,1
金,190628,14,1
土,190629,16,1
日,190630,24,1
月,190701,2,1
火,190702,6,1
水,190703,0,1
木,190704,3,1
金,190705,5,1
土,190706,30,1
日,190707,39,1
月,190708,7,1
火,190709,1,1
水,190710,0,1
木,190711,0,1
金,190712,13,1
土,190713,12,1
日,190714,100,1
月,190715,73,1
火,190716,4,1
水,190717,0,1
木,190718,0,1
金,190719,4,1
土,190720,13,1
日,190721,38,1
月,190722,14,1
火,190723,28,1
水,190724,33,1
木,190725,39,1
金,190726,39,1
土,190727,84,1
日,190728,82,1
月,190729,28,1
火,190730,64,1
水,190731,29,1
木,190801,33,1
金,190802,58,1
土,190803,92,1
日,190804,81,1
月,190805,56,1
火,190806,43,1
水,190807,59,1
木,190808,66,1
金,190809,79,1
土,190810,125,1
日,190811,219,1
月,190812,196,1
火,190813,207,1
水,190814,143,1
木,190815,1,1
金,190816,135,1
土,190817,159,1
日,190818,160,1
月,190819,61,1
火,190820,40,1
水,190821,40,1
木,190822,83,1
金,190823,23,1
土,190824,113,1
日,190825,118,1
月,190826,46,1
火,190827,8,1
水,190828,1,1
木,190829,8,1
金,190830,14,1
土,190831,52,1
日,190901,18,1
月,190902,7,1
火,190903,7,1
水,190904,0,1
木,190905,5,1
金,190906,19,1
土,190907,77,1
日,190908,69,1
月,190909,12,1
火,190910,6,1
水,190911,0,1
木,190912,3,1
金,190913,8,1
土,190914,88,1
日,190915,184,1
月,190916,112,1
火,190917,13,1
水,190918,0,1
木,190919,7,1
金,190920,13,1
土,190921,4,1
日,190922,11,1
月,190923,20,1
火,190924,18,1
水,190925,0,1
木,190926,11,1
金,190927,3,1
土,190928,30,1
日,190929,43,1
月,190930,12,1
火,191001,5,1
水,191002,0,1
木,191003,0,1
金,191004,8,1
土,191005,32,1
日,191006,26,1
月,191007,9,1
火,191008,7,1
水,191009,0,1
木,191010,11,1
金,191011,7,1
土,191012,0,1
日,191013,115,1
月,191014,96,1
火,191015,10,1
水,191016,0,1
木,191017,4,1
金,191018,0,1
土,191019,18,1
日,191020,47,1
月,191021,23,1
火,191022,42,1
水,191023,0,1
木,191024,0,1
金,191025,4,1
土,191026,23,1
日,191027,84,1
月,191028,11,1
火,191029,12,1
水,191030,0,1
木,191031,5,1
金,191101,5,1
土,191102,88,1
日,191103,157,1
月,191104,109,1
火,191105,14,1
水,191106,0,1
木,191107,7,1
金,191108,2,1
土,191109,29,1
日,191110,69,1
月,191111,3,1
火,191112,2,1
水,191113,0,1
木,191114,2,1
金,191115,20,1
土,191116,29,1
日,191117,45,1
月,191118,5,1
火,191119,3,1
水,191120,0,1
木,191121,1,1
金,191122,7,1
土,191123,60,1
日,191124,45,1
月,191125,4,1
火,191126,0,1
水,191127,0,1
木,191128,1,1
金,191129,2,1
土,191130,18,1
日,191201,34,1
月,191202,0,1
火,191203,3,1
水,191204,0,1
木,191205,0,1
金,191206,0,1
土,191207,16,1
日,191208,10,1
月,191209,2,1
火,191210,5,1
水,191211,0,1
木,191212,0,1
金,191213,0,1
土,191214,1,1
日,191215,8,1
月,191216,1,1
火,191217,0,1
水,191218,0,1
木,191219,3,1
金,191220,0,1
土,191221,9,1
日,191222,5,1
月,191223,2,1
火,191224,0,1
水,191225,0,1
木,191226,5,1
金,191227,3,1
土,191228,19,1
日,191229,24,1
月,191230,18,1
火,191231,0,1
水,200101,0,1
木,200102,0,1
金,200103,0,1
土,200104,47,1
日,200105,7,1
月,200106,5,1
火,200107,0,1
水,200108,0,1
木,200109,2,1
金,200110,0,1
土,200111,15,1
日,200112,11,1
月,200113,10,1
火,200114,0,1
水,200115,0,1
木,200116,0,1
金,200117,0,1
土,200118,5,1
日,200119,5,1
月,200120,0,1
火,200121,0,1
水,200122,0,1
木,200123,2,1
金,200124,3,1
土,200125,6,1
日,200126,20,1
月,200127,0,1
火,200128,0,1
水,200129,0,1
木,200130,0,1
金,200131,0,1
土,200201,0,1
日,200202,11,1
月,200203,3,1
火,200204,0,1
水,200205,0,1
木,200206,0,1
金,200207,2,1
土,200208,1,1
日,200209,0,1
月,200210,3,1
火,200211,8,1
水,200212,0,1
木,200213,0,1
金,200214,1,1
土,200215,1,1
日,200216,2,1
月,200217,5,1
火,200218,0,1
水,200219,0,1
木,200220,2,1
金,200221,2,1
土,200222,2,1
日,200223,41,1
月,200224,45,1
火,200225,0,1
水,200226,0,1
木,200227,0,1
金,200228,0,1
土,200229,2,1
日,200301,14,1
月,200302,0,1
火,200303,3,1
水,200304,0,1
木,200305,6,1
金,200306,6,1
土,200307,6,1
日,200308,9,1
月,200309,5,1
火,200310,0,1
水,200311,0,1
木,200312,5,1
金,200313,7,1
土,200314,9,1
日,200315,11,1
月,200316,0,1
火,200317,3,1
水,200318,0,1
木,200319,8,1
金,200320,52,1
土,200321,84,1
日,200322,40,1
月,200323,17,1
火,200324,17,1
水,200325,0,1
木,200326,29,1
金,200327,2,1
土,200328,11,1
日,200329,29,1
月,200330,23,1
火,200331,18,1
水,200401,0,1
木,200402,5,1
金,200403,17,1
土,200404,27,1
日,200405,22,1
月,200406,5,1
火,200407,1,1
水,200408,0,1
木,200409,5,1
金,200410,3,1
土,200411,6,1
日,200412,0,1
月,200413,0,1
火,200414,0,1
水,200415,0,1
木,200416,0,1
金,200417,0,1
土,200418,2,1
日,200419,9,1
月,200420,2,1
火,200421,0,0
水,200422,0,0
木,200423,0,0
金,200424,0,0
土,200425,0,0
日,200426,0,0
月,200427,0,0
火,200428,0,0
水,200429,0,0
木,200430,0,0
金,200501,0,0
土,200502,0,0
日,200503,0,0
月,200504,0,0
火,200505,0,0
水,200506,0,0
木,200507,0,0
金,200508,0,0
土,200509,0,0
日,200510,0,0
月,200511,0,0
火,200512,0,0
水,200513,0,0
木,200514,0,0
金,200515,0,0
土,200516,0,0
日,200517,0,0
月,200518,4,1
火,200519,2,1
水,200520,0,1
木,200521,0,1
金,200522,4,1
土,200523,10,1
日,200524,38,1
月,200525,0,1
火,200526,0,1
水,200527,0,1
木,200528,5,1
金,200529,2,1
土,200530,31,1
日,200531,6,1
月,200601,5,1
火,200602,2,1
水,200603,0,1
木,200604,3,1
金,200605,5,1
土,200606,38,1
日,200607,82,1
月,200608,8,1
火,200609,6,1
水,200610,0,1
木,200611,0,1
金,200612,0,1
土,200613,0,1
日,200614,10,1
月,200615,3,1
火,200616,9,1
水,200617,0,1
木,200618,3,1
金,200619,3,1
土,200620,40,1
日,200621,100,1
月,200622,2,1
火,200623,7,1
水,200624,0,1
木,200625,0,1
金,200626,6,1
土,200627,34,1
日,200628,72,1
月,200629,4,1
火,200630,0,1
水,200701,0,1
木,200702,6,1
金,200703,1,1
土,200704,6,1
日,200705,58,1
月,200706,0,1
火,200707,0,1
水,200708,0,1
木,200709,4,1
金,200710,1,1
土,200711,17,1
日,200712,19,1
月,200713,2,1
火,200714,1,1
水,200715,0,1
木,200716,11,1
金,200717,3,1
土,200718,46,1
日,200719,56,1
月,200720,14,1
火,200721,3,1
水,200722,0,1
木,200723,96,1
金,200724,54,1
土,200725,104,1
日,200726,59,1
月,200727,14,1
火,200728,7,1
水,200729,1,1
木,200730,10,1
金,200731,36,1
土,200801,52,1
日,200802,45,1
月,200803,52,1
火,200804,48,1
水,200805,60,1
木,200806,46,1
金,200807,49,1
土,200808,124,1
日,200809,201,1
月,200810,207,1
火,200811,175,1
水,200812,162,1
木,200813,215,1
金,200814,239,1
土,200815,235,1
日,200816,167,1
月,200817,94,1
火,200818,66,1
水,200819,29,1
木,200820,40,1
金,200821,54,1
土,200822,82,1
日,200823,76,1
月,200824,52,1
火,200825,23,1
水,200826,9,1
木,200827,20,1
金,200828,16,1
土,200829,61,1
日,200830,83,1
月,200831,18,1
火,200901,3,1
水,200902,0,1
木,200903,6,1
金,200904,7,1
土,200905,42,1
日,200906,30,1
月,200907,0,1
火,200908,16,1
水,200909,0,1
木,200910,21,1
金,200911,5,1
土,200912,31,1
日,200913,85,1
月,200914,10,1
火,200915,14,1
水,200916,0,1
木,200917,0,1
金,200918,9,1
土,200919,114,1
日,200920,285,1
月,200921,303,1
火,200922,235,1
水,200923,0,1
木,200924,12,1
金,200925,7,1
土,200926,20,1
日,200927,49,1
月,200928,22,1
火,200929,14,1
水,200930,0,1
木,201001,5,1
金,201002,3,1
土,201003,60,1
日,201004,78,1
月,201005,21,1
火,201006,10,1
水,201007,0,1
木,201008,3,1
金,201009,1,1
土,201010,9,1
日,201011,54,1
月,201012,25,1
火,201013,22,1
水,201014,0,1
木,201015,54,1
金,201016,25,1
土,201017,43,1
日,201018,95,1
月,201019,16,1
火,201020,17,1
水,201021,0,1
木,201022,0,1
金,201023,8,1
土,201024,40,1
日,201025,91,1
月,201026,25,1
火,201027,8,1
水,201028,0,1
木,201029,10,1
金,201030,18,1
土,201031,68,1
日,201101,106,1
月,201102,1,1
火,201103,67,1
水,201104,0,1
木,201105,8,1
金,201106,23,1
土,201107,25,1
日,201108,89,1
月,201109,19,1
火,201110,3,1
水,201111,0,1
木,201112,6,1
金,201113,13,1
土,201114,58,1
日,201115,85,1
月,201116,10,1
火,201117,13,1
水,201118,0,1
木,201119,5,1
金,201120,8,1
土,201121,49,1
日,201122,110,1
月,201123,51,1
火,201124,9,1
水,201125,0,1
木,201126,10,1
金,201127,11,1
土,201128,25,1
日,201129,35,1
月,201130,9,1
火,201201,4,1
水,201202,0,1
木,201203,2,1
金,201204,1,1
土,201205,27,1
日,201206,41,1
月,201207,2,1
火,201208,9,1
水,201209,0,1
木,201210,7,1
金,201211,1,1
土,201212,29,1
日,201213,28,1
月,201214,1,1
火,201215,0,1
水,201216,0,1
木,201217,0,1
金,201218,0,1
土,201219,2,1
日,201220,0,1
月,201221,0,1
火,201222,0,1
水,201223,0,1
木,201224,0,1
金,201225,0,1
土,201226,13,1
日,201227,12,1
月,201228,4,1
火,201229,0,1
水,201230,0,1
木,201231,0,1
金,210101,0,1
土,210102,0,1
日,210103,9,1
月,210104,3,1
火,210105,0,1
水,210106,0,1
木,210107,0,1
金,210108,0,1
土,210109,0,1
日,210110,10,1
月,210111,2,1
火,210112,0,1
水,210113,0,1
木,210114,0,1
金,210115,0,1
土,210116,2,1
日,210117,0,1
月,210118,0,1
火,210119,0,1
水,210120,0,1
木,210121,0,1
金,210122,0,1
土,210123,0,1
日,210124,1,1
月,210125,0,1
火,210126,0,1
水,210127,0,1
木,210128,0,1
金,210129,0,1
土,210130,0,1
日,210131,9,1
月,210201,1,1
火,210202,0,1
水,210203,0,1
木,210204,1,1
金,210205,3,1
土,210206,6,1
日,210207,7,1
月,210208,0,1
火,210209,0,1
水,210210,0,1
木,210211,17,1
金,210212,2,1
土,210213,9,1
日,210214,17,1
月,210215,4,1
火,210216,0,1
水,210217,0,1
木,210218,1,1
金,210219,1,1
土,210220,3,1
日,210221,23,1
月,210222,11,1
火,210223,13,1
水,210224,0,1
木,210225,2,1
金,210226,0,1
土,210227,11,1
日,210228,16,1
月,210301,0,1
火,210302,0,1
水,210303,0,1
木,210304,3,1
金,210305,0,1
土,210306,4,1
日,210307,24,1
月,210308,0,1
火,210309,6,1
水,210310,0,1
木,210311,4,1
金,210312,0,1
土,210313,0,1
日,210314,42,1
月,210315,14,1
火,210316,0,1
水,210317,0,1
木,210318,9,1
金,210319,3,1
土,210320,59,1
日,210321,4,1
月,210322,16,1
火,210323,9,1
水,210324,0,1
木,210325,27,1
金,210326,17,1
土,210327,62,1
日,210328,5,1
月,210329,39,1
火,210330,36,1
水,210331,0,1
木,210401,48,1
金,210402,42,1
土,210403,43,1
日,210404,8,1
月,210405,42,1
火,210406,33,1
水,210407,0,1
木,210408,3,1
金,210409,2,1
土,210410,21,1
日,210411,46,1
月,210412,1,1
火,210413,0,1
水,210414,0,1
木,210415,9,1
金,210416,1,1
土,210417,2,1
日,210418,13,1
月,210419,5,1
火,210420,6,1
水,210421,0,1
木,210422,6,1
金,210423,1,1
土,210424,26,1
日,210425,38,1
月,210426,11,1
火,210427,1,1
水,210428,0,1
木,210429,3,1
金,210430,38,1
土,210501,57,1
日,210502,6,1
月,210503,299,1
火,210504,222,1
水,210505,11,1
木,210506,24,1
金,210507,8,1
土,210508,16,1
日,210509,46,1
月,210510,2,1
火,210511,0,1
水,210512,0,1
木,210513,6,1
金,210514,0,1
土,210515,6,1
日,210516,0,1
月,210517,2,1
火,210518,2,1
水,210519,0,1
木,210520,0,1
金,210521,1,1
土,210522,6,1
日,210523,14,1
月,210524,0,1
火,210525,2,1
水,210526,0,1
木,210527,0,1
金,210528,1,1
土,210529,9,1
日,210530,12,1
月,210531,1,1
火,210601,3,1
水,210602,0,1
木,210603,0,1
金,210604,1,1
土,210605,8,1
日,210606,37,1
月,210607,0,1
火,210608,10,1
水,210609,0,1
木,210610,1,1
金,210611,3,1
土,210612,0,1
日,210613,10,1
月,210614,0,1
火,210615,4,1
水,210616,0,1
木,210617,0,1
金,210618,0,1
土,210619,8,1
日,210620,39,1
月,210621,12,1
火,210622,0,1
水,210623,0,1
木,210624,9,1
金,210625,4,1
土,210626,39,1
日,210627,24,1
月,210628,2,1
火,210629,1,1
水,210630,0,1
木,210701,3,1
金,210702,6,1
土,210703,11,1
日,210704,33,1
月,210705,2,1
火,210706,4,1
水,210707,0,1
木,210708,1,1
金,210709,0,1
土,210710,19,1
日,210711,37,1
月,210712,1,1
火,210713,8,1
水,210714,0,1
木,210715,2,1
金,210716,13,1
土,210717,54,1
日,210718,67,1
月,210719,5,1
火,210720,16,1
水,210721,0,1
木,210722,158,1
金,210723,203,1
土,210724,154,1
日,210725,104,1
月,210726,37,1
火,210727,16,1
水,210728,33,1
木,210729,44,1
金,210730,42,1
土,210731,98,1
日,210801,126,1
月,210802,60,1
火,210803,41,1
水,210804,39,1
木,210805,40,1
金,210806,37,1
土,210807,71,1
日,210808,140,1
月,210809,3,1
火,210810,146,1
水,210811,158,1
木,210812,34,1
金,210813,16,1
土,210814,10,1
日,210815,70,1
月,210816,69,1
火,210817,4,1
水,210818,15,1
木,210819,13,1
金,210820,60,1
土,210821,40,1
日,210822,84,1
月,210823,20,1
火,210824,21,1
水,210825,28,1
木,210826,45,1
金,210827,34,1
土,210828,45,1
日,210829,93,1
月,210830,16,1
火,210831,7,1
水,210901,0,1
木,210902,3,1
金,210903,4,1
土,210904,22,1
日,210905,63,1
月,210906,21,1
火,210907,7,1
水,210908,0,1
木,210909,6,1
金,210910,9,1
土,210911,57,1
日,210912,62,1
月,210913,15,1
火,210914,2,1
水,210915,0,1
木,210916,3,1
金,210917,0,1
土,210918,19,1
日,210919,220,1
月,210920,51,1
火,210921,8,1
水,210922,0,1
木,210923,65,1
金,210924,35,1
土,210925,87,1
日,210926,73,1
月,210927,21,1
火,210928,6,1
水,210929,0,1
木,210930,11,1
金,211001,2,1
土,211002,58,1
日,211003,105,1
月,211004,8,1
火,211005,6,1
水,211006,0,1
木,211007,15,1
金,211008,13,1
土,211009,92,1
日,211010,102,1
月,211011,22,1
火,211012,3,1
水,211013,0,1
木,211014,5,1
金,211015,12,1
土,211016,57,1
日,211017,10,1
月,211018,11,1
火,211019,5,1
水,211020,0,1
木,211021,6,1
金,211022,26,1
土,211023,55,1
日,211024,99,1
月,211025,5,1
火,211026,8,1
水,211027,0,1
木,211028,10,1
金,211029,8,1
土,211030,96,1
日,211031,92,1
月,211101,19,1
火,211102,27,1
水,211103,116,1
木,211104,0,1
金,211105,11,1
土,211106,76,1
日,211107,125,1
月,211108,14,1
火,211109,8,1
水,211110,0,1
木,211111,1,1
金,211112,3,1
土,211113,46,1
日,211114,102,1
月,211115,20,1
火,211116,7,1
水,211117,0,1
木,211118,10,1
金,211119,21,1
土,211120,38,1
日,211121,106,1
月,211122,2,1
火,211123,18,1
水,211124,0,1
木,211125,1,1
金,211126,0,0
土,211127,0,0
日,211128,0,0
月,211129,0,0
火,211130,0,0
水,211201,0,0
木,211202,0,0
金,211203,0,0
土,211204,0,0
日,211205,0,0
月,211206,0,0
火,211207,0,0
水,211208,0,0
木,211209,0,0
金,211210,0,0
土,211211,0,0
日,211212,0,0
月,211213,0,0
火,211214,0,0
水,211215,0,0
木,211216,0,0
金,211217,0,0
土,211218,0,0
日,211219,0,0
月,211220,0,0
火,211221,0,0
水,211222,0,0
木,211223,0,0
金,211224,0,0
土,211225,0,0
日,211226,0,0
月,211227,0,0
火,211228,0,0
水,211229,0,0
木,211230,0,0
金,211231,0,0
土,220101,,0
日,220102,,0
月,220103,,0
火,220104,,0
水,220105,,0
木,220106,,0
金,220107,,0
土,220108,,0
日,220109,,0
月,220110,,0
火,220111,,0
水,220112,,0
木,220113,,0
金,220114,,0
土,220115,,0
日,220116,,0
月,220117,,0
火,220118,,0
水,220119,,0
木,220120,,0
金,220121,,0
土,220122,,0
日,220123,,0
月,220124,,0
火,220125,,0
水,220126,,0
木,220127,,0
金,220128,,0
土,220129,,0
日,220130,,0
月,220131,,0
火,220201,,0
水,220202,,0
木,220203,,0
金,220204,,0
土,220205,,0
日,220206,,0
月,220207,,0
火,220208,,0
水,220209,,0
木,220210,,0
金,220211,,0
土,220212,,0
日,220213,,0
月,220214,,0
火,220215,,0
水,220216,,0
木,220217,,0
金,220218,,0
土,220219,,0
日,220220,,0
月,220221,,0
火,220222,,0
水,220223,,0
木,220224,,0
金,220225,,0
土,220226,,0
日,220227,,0
月,220228,,0
火,220301,0,0
水,220302,0,0
木,220303,0,0
金,220304,0,0
土,220305,0,0
日,220306,0,0
月,220307,0,0
火,220308,0,0
水,220309,0,0
木,220310,0,0
金,220311,0,0
土,220312,0,0
日,220313,0,0
月,220314,0,0
火,220315,0,0
水,220316,0,0
木,220317,0,0
金,220318,0,0
土,220319,3,1
日,220320,58,1
月,220321,48,1
火,220322,0,1
水,220323,0,1
木,220324,12,1
金,220325,10,1
土,220326,0,1
日,220327,50,1
月,220328,18,1
火,220329,29,1
水,220330,0,1
木,220331,20,1
金,220401,28,1
土,220402,37,1
日,220403,44,1
月,220404,27,1
火,220405,15,1
水,220406,0,1
木,220407,7,1
金,220408,4,1
土,220409,53,1
日,220410,32,1
月,220411,9,1
火,220412,3,1
水,220413,0,1
木,220414,0,1
金,220415,3,1
土,220416,37,1
日,220417,53,1
月,220418,3,1
火,220419,9,1
水,220420,0,1
木,220421,0,1
金,220422,6,1
土,220423,41,1
日,220424,36,1
月,220425,8,1
火,220426,0,1
水,220427,0,1
木,220428,10,1
金,220429,9,1
土,220430,205,1
日,220501,138,1
月,220502,97,1
火,220503,292,1
水,220504,312,1
木,220505,244,1
金,220506,45,1
土,220507,136,1
日,220508,107,1
月,220509,12,1
火,220510,2,1
水,220511,0,1
木,220512,0,1
金,220513,0,1
土,220514,23,1
日,220515,74,1
月,220516,7,1
火,220517,4,1
水,220518,0,1
木,220519,7,1
金,220520,4,1
土,220521,43,1
日,220522,61,1
月,220523,27,1
火,220524,1,1
水,220525,0,1
木,220526,1,1
金,220527,6,1
土,220528,54,1
日,220529,57,1
月,220530,1,1
火,220531,6,1
水,220601,0,1
木,220602,5,1
金,220603,2,1
土,220604,54,1
日,220605,43,1
月,220606,1,1
火,220607,4,1
水,220608,0,1
木,220609,5,1
金,220610,1,1
土,220611,29,1
日,220612,69,1
月,220613,11,1
火,220614,0,1
水,220615,0,1
木,220616,15,1
金,220617,8,1
土,220618,53,1
日,220619,64,1
月,220620,5,1
火,220621,2,1
水,220622,0,1
木,220623,10,1
金,220624,4,1
土,220625,38,1
日,220626,47,1
月,220627,11,1
火,220628,7,1
水,220629,0,1
木,220630,6,1
金,220701,6,1
土,220702,35,1
日,220703,25,1
月,220704,1,1
火,220705,4,1
水,220706,0,1
木,220707,6,1
金,220708,1,1
土,220709,6,1
日,220710,57,1
月,220711,13,1
火,220712,0,1
水,220713,0,1
木,220714,0,1
金,220715,8,1
土,220716,46,1
日,220717,153,1
月,220718,98,1
火,220719,1,1
水,220720,0,1
木,220721,5,1
金,220722,9,1
土,220723,71,1
日,220724,80,1
月,220725,46,1
火,220726,61,1
水,220727,21,1
木,220728,12,1
金,220729,49,1
土,220730,120,1
日,220731,122,1
月,220801,51,1
火,220802,37,1
水,220803,25,1
木,220804,58,1
金,220805,85,1
土,220806,82,1
日,220807,107,1
月,220808,79,1
火,220809,70,1
水,220810,82,1
木,220811,183,1
金,220812,167,1
土,220813,223,1
日,220814,179,1
月,220815,195,1
火,220816,129,1
水,220817,23,1
木,220818,96,1
金,220819,102,1
土,220820,80,1
日,220821,127,1
月,220822,89,1
火,220823,68,1
水,220824,35,1
木,220825,32,1
金,220826,52,1
土,220827,48,1
日,220828,100,1
月,220829,28,1
火,220830,24,1
水,220831,0,1
木,220901,0,1
金,220902,0,1
土,220903,24,1
日,220904,69,1
月,220905,14,1
火,220906,0,1
水,220907,0,1
木,220908,6,1
金,220909,16,1
土,220910,44,1
日,220911,82,1
月,220912,23,1
火,220913,8,1
水,220914,0,1
木,220915,23,1
金,220916,19,1
土,220917,64,1
日,220918,77,1
月,220919,0,1
火,220920,3,1
水,220921,0,1
木,220922,14,1
金,220923,74,1
土,220924,164,1
日,220925,107,1
月,220926,19,1
火,220927,0,1
水,220928,0,1
木,220929,6,1
金,220930,13,1
土,221001,37,1
日,221002,70,1
月,221003,18,1
火,221004,7,1
水,221005,0,1
木,221006,8,1
金,221007,12,1
土,221008,64,1
日,221009,150,1
月,221010,74,1
火,221011,13,1
水,221012,0,1
木,221013,14,1
金,221014,12,1
土,221015,56,1
日,221016,89,1
月,221017,14,1
火,221018,4,1
水,221019,0,1
木,221020,12,1
金,221021,18,1
土,221022,102,1
日,221023,96,1
月,221024,12,1
火,221025,0,1
水,221026,0,1
木,221027,8,1
金,221028,13,1
土,221029,79,1
日,221030,95,1
月,221031,18,1
火,221101,1,1
水,221102,0,1
木,221103,113,1
金,221104,40,1
土,221105,45,1
日,221106,93,1
月,221107,22,1
火,221108,17,1
水,221109,0,1
木,221110,21,1
金,221111,19,1
土,221112,87,1
日,221113,34,1
月,221114,40,1
火,221115,4,1
水,221116,0,1
木,221117,12,1
金,221118,18,1
土,221119,74,1
日,221120,90,1
月,221121,28,1
火,221122,11,1
水,221123,3,1
木,221124,0,1
金,221125,5,1
土,221126,41,1
日,221127,70,1
月,221128,28,1
火,221129,2,1
水,221130,0,1
木,221201,1,1
金,221202,1,1
土,221203,30,1
日,221204,40,1
月,221205,2,1
火,221206,2,1
水,221207,0,1
木,221208,2,1
金,221209,1,1
土,221210,47,1
日,221211,14,1
月,221212,7,1
火,221213,0,1
水,221214,0,1
木,221215,2,1
金,221216,0,1
土,221217,4,1
日,221218,3,1
月,221219,0,1
火,221220,0,1
水,221221,0,1
木,221222,0,1
金,221223,0,1
土,221224,0,1
日,221225,2,1
月,221226,0,1
火,221227,1,1
水,221228,0,1
木,221229,0,1
金,221230,0,1
土,221231,0,1
日,230101,0,1
月,230102,0,1
火,230103,0,1
水,230104,3,1
木,230105,5,1
金,230106,1,1
土,230107,5,1
日,230108,8,1
月,230109,5,1
火,230110,0,1
水,230111,0,1
木,230112,4,1
金,230113,1,1
土,230114,2,1
日,230115,5,1
月,230116,0,1
火,230117,0,1
水,230118,0,1
木,230119,2,1
金,230120,5,1
土,230121,5,1
日,230122,2,1
月,230123,0,1
火,230124,0,1
水,230125,0,1
木,230126,0,1
金,230127,0,1
土,230128,0,1
日,230129,0,1
月,230130,0,1
火,230131,0,1
水,230201,0,1
木,230202,0,1
金,230203,0,1
土,230204,2,1
日,230205,7,1
月,230206,8,1
火,230207,0,1
水,230208,0,1
木,230209,0,1
金,230210,0,1
土,230211,8,1
日,230212,20,1
月,230213,6,1
火,230214,0,1
水,230215,0,1
木,230216,0,1
金,230217,0,1
土,230218,1,1
日,230219,7,1
月,230220,1,1
火,230221,0,1
水,230222,0,1
木,230223,10,1
金,230224,1,1
土,230225,5,1
日,230226,10,1
月,230227,6,1
火,230228,0,1
水,230301,0,1
木,230302,0,1
金,230303,2,1
土,230304,17,1
日,230305,36,1
月,230306,2,1
火,230307,3,1
水,230308,0,1
木,230309,8,1
金,230310,9,1
土,230311,39,1
日,230312,55,1
月,230313,3,1
火,230314,7,1
水,230315,0,1
木,230316,4,1
金,230317,3,1
土,230318,25,1
日,230319,86,1
月,230320,30,1
火,230321,5,1
水,230322,0,1
木,230323,0,1
金,230324,10,1
土,230325,49,1
日,230326,57,1
月,230327,37,1
火,230328,24,1
水,230329,0,1
木,230330,54,1
金,230331,48,1`;

document.addEventListener("DOMContentLoaded", (event) => {
  const pricePerVisitor = 2710;
  const goldenWeekStarts = {
    2017: "170501",
    2018: "180430",
    2019: "190429",
    2020: "200504",
    2021: "210503",
    2022: "220502",
    2023: "230501",
    2024: "240429",
  };
  const japaneseDays = ["日", "月", "火", "水", "木", "金", "土"];
  let factor = 1;
  const tolerance = 0.001;

  const calculateDate = (dateStr) => {
    let [year, month, day] = dateStr.match(/.{2}/g).map(Number);
    return new Date(2000 + year, month - 1, day);
  };

  const parseData = (data) => {
    return data
      .split("\n")
      .filter((line) => line.trim())
      .map((line) => {
        let [dow, date, visitors, isCount] = line.split(",");
        return {
          dow: dow.trim(),
          date: calculateDate(date.trim()),
          visitors: parseInt(visitors.trim()),
          isCount: isCount.trim() === "1" ? 1 : 0,
        };
      });
  };

  const calculate52WeekStructure = (row, goldenWeekStarts) => {
    let startOfGoldenWeek = calculateDate(
      goldenWeekStarts[row.date.getFullYear()]
    );
    let daysSinceGoldenWeek = Math.floor(
      (row.date - startOfGoldenWeek) / (1000 * 60 * 60 * 24)
    );
    let dayOfWeek =
      (daysSinceGoldenWeek + 7 - startOfGoldenWeek.getDay() + 1) % 7;
    return [Math.floor(daysSinceGoldenWeek / 7) + 1, dayOfWeek];
  };

  function generateFullDateRange(data) {
    let startDate = data[0].date;
    let endDate = data[data.length - 1].date;
    let fullRange = [];
    for (
      let d = new Date(startDate);
      d <= endDate;
      d.setDate(d.getDate() + 1)
    ) {
      let found = data.find((r) => r.date.toDateString() === d.toDateString());
      fullRange.push(
        found || {
          date: new Date(d),
          dow: japaneseDays[d.getDay()],
          visitors: 0,
          isCount: 0,
        }
      );
    }
    return fullRange;
  }

  // Helper function to validate input
  function validateInput(inputId, isNumberRequired) {
    const inputElement = document.getElementById(inputId);
    let value = inputElement.value.trim();

    if (isNumberRequired && (value === "" || isNaN(Number(value)))) {
      inputElement.value = "";
      inputElement.focus();
      return false;
    }
    return true;
  }

  function calculate() {
    // if (
    //   !validateInput("yearMonth", true) ||
    //   !validateInput("targetSales", true)
    // ) {
    //   alert("年月または目標売上高が無効です。入力してください。");
    //   return;
    // }

    // let yearMonth = document.getElementById("yearMonth").value;
    // let targetSales = parseInt(document.getElementById("targetSales").value);
    // let closedDates = document
    //   .getElementById("closedDates")
    //   .value.split(",")
    //   .map(Number);

    // // Validate closedDates
    // if (!closedDates.every((date) => !isNaN(Number(date)))) {
    //   document.getElementById("closedDates").value = "";
    //   document.getElementById("closedDates").focus();
    //   alert("閉店日が無効です。数字で入力してください。");
    //   return;
    // }

    let invalidInputs = [];

    if (!validateInput("yearMonth", true)) invalidInputs.push("年月");
    if (!validateInput("targetSales", true)) invalidInputs.push("目標売上高");

    let closedDates = document
      .getElementById("closedDates")
      .value.split(",")
      .map(Number);
    if (!closedDates.every((date) => !isNaN(date))) {
      document.getElementById("closedDates").value = "";
      invalidInputs.push("営業無い日");
    }

    if (invalidInputs.length > 0) {
      alert(
        `以下の入力が無効です: ${invalidInputs.join(", ")}. 入力してください。`
      );
      // Focus on the first invalid input if closedDates isn't the only invalid one
      if (invalidInputs.length > 1 || invalidInputs[0] !== "営業無い日") {
        document.getElementById("yearMonth").focus();
      } else {
        document.getElementById("closedDates").focus();
      }
      return;
    }

    let yearMonth = document.getElementById("yearMonth").value;
    let targetSales = parseInt(document.getElementById("targetSales").value);

    let analyzeYear = 2000 + parseInt(yearMonth.slice(0, 2));
    let analyzeMonth = parseInt(yearMonth.slice(2, 4));

    if (!goldenWeekStarts[analyzeYear]) {
      // alert(`Golden Week start date for year ${analyzeYear} is not defined.`);
      document.getElementById("yearMonth").focus();
      return;
    }

    let data = parseData(visitorData);
    let currentYearStart = calculateDate(goldenWeekStarts[analyzeYear]);
    let avgVisitors = {};

    let fullData = generateFullDateRange(data);

    fullData.forEach((row) => {
      if (row.isCount !== 1) return;

      let [week, dayOfWeek] = calculate52WeekStructure(row, goldenWeekStarts);
      let alignedDate = new Date(currentYearStart);
      alignedDate.setDate(alignedDate.getDate() + (week - 1) * 7 + dayOfWeek);

      if (
        alignedDate.getFullYear() === analyzeYear &&
        alignedDate.getMonth() + 1 === analyzeMonth
      ) {
        let dateKey = alignedDate.toLocaleDateString("ja-JP").slice(0, 10);
        if (!avgVisitors[dateKey])
          avgVisitors[dateKey] = { totalVisitors: 0, count: 0 };
        avgVisitors[dateKey].totalVisitors += row.visitors;
        avgVisitors[dateKey].count++;
      }
    });

    for (let dateKey in avgVisitors) {
      avgVisitors[dateKey].averageVisitors = Math.round(
        avgVisitors[dateKey].totalVisitors / avgVisitors[dateKey].count
      );
    }

    while (true) {
      let totalSales = Object.keys(avgVisitors).reduce((sum, dateStr) => {
        let newVisitors = Math.round(
          avgVisitors[dateStr].averageVisitors * factor
        );
        let date = new Date(dateStr);
        if (closedDates.includes(date.getDate())) newVisitors = 0;
        return sum + newVisitors * pricePerVisitor;
      }, 0);

      if (totalSales > targetSales) break;
      factor += tolerance;
    }

    let tableContent = `<table><tr><th>曜日</th><th>年月日</th><th>平均 (過去)</th><th>平均 (計画)</th><th>売上目標高</th></tr>`;
    let totals = { pastVisitors: 0, pastSales: 0, newVisitors: 0, newSales: 0 };

    for (let dateStr in avgVisitors) {
      let row = avgVisitors[dateStr];
      let date = new Date(dateStr);
      let formattedDate = date
        .toLocaleDateString("ja-JP", {
          year: "2-digit",
          month: "2-digit",
          day: "2-digit",
        })
        .replace(/\//g, "");
      let pastVisitors = row.averageVisitors;

      let newVisitors = closedDates.includes(date.getDate())
        ? 0
        : Math.round(row.averageVisitors * factor);
      let newSales = newVisitors * pricePerVisitor;

      totals.pastVisitors += pastVisitors;
      totals.newVisitors += newVisitors;
      totals.newSales += newSales;

      tableContent += `<tr>
                    <td>${japaneseDays[date.getDay()]}</td>
                    <td>${formattedDate}</td>
                    <td>${pastVisitors}</td>
                    <td>${newVisitors}</td>
                    <td>¥${newSales.toLocaleString()}</td>
                </tr>`;
    }

    tableContent += `<tr><td>合計</td><td></td>
                <td>${totals.pastVisitors}</td>
                <td>${totals.newVisitors}</td>
                <td>¥${totals.newSales.toLocaleString()}</td></tr></table>`;

    document.getElementById("outputTable").innerHTML = tableContent;
    document
      .getElementById("generateCsv")
      .addEventListener("click", function () {
        downloadCSV(avgVisitors, closedDates);
      });
  }

  function downloadCSV(avgVisitors, closedDates) {
    let csvContent = "\uFEFF"; // UTF-8 BOM
    csvContent += "曜日,年月日,平均 (過去),平均 (計画),売上目標高\n";
    let totals = { pastVisitors: 0, newVisitors: 0, newSales: 0 };

    for (let dateStr in avgVisitors) {
      let row = avgVisitors[dateStr];
      let date = new Date(dateStr);
      let formattedDate = date
        .toLocaleDateString("ja-JP", {
          year: "2-digit",
          month: "2-digit",
          day: "2-digit",
        })
        .replace(/\//g, "");
      let pastVisitors = row.averageVisitors;
      let newVisitors = closedDates.includes(date.getDate())
        ? 0
        : Math.round(row.averageVisitors * factor);
      let newSales = newVisitors * pricePerVisitor;

      totals.pastVisitors += pastVisitors;
      totals.newVisitors += newVisitors;
      totals.newSales += newSales;

      csvContent += `"${
        japaneseDays[date.getDay()]
      }",${formattedDate},${pastVisitors},${newVisitors},${newSales}\n`;
    }

    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);

    const link = document.createElement("a");
    link.href = url;
    link.download = "引き馬計画.csv";
    link.style.visibility = "hidden";
    document.body.appendChild(link);
    link.click();
    URL.revokeObjectURL(url);
    document.body.removeChild(link);
  }

  // Add input event listeners for immediate validation feedback
  document.getElementById("yearMonth").addEventListener("input", function () {
    validateInput("yearMonth", true);
  });
  document.getElementById("targetSales").addEventListener("input", function () {
    validateInput("targetSales", true);
  });
  document.getElementById("closedDates").addEventListener("input", function () {
    validateInput("closedDates", false);
  });
  document.getElementById("calculate").addEventListener("click", calculate);
});
